function tui_editimage(recid,imgid,editcalback){var image,imageSrc=document.querySelector('img[id="'+imgid+'"]').getAttribute("src");window.upload_saveAs=function(dataURL,name){"function"!=typeof showLoadIcon&&($("body").append('<div id="loadicon" style="display: none; position: fixed; z-index: 1200; padding: 0; left: 10px; top: 60px;"><img src="/tpl/img/ajax-loader.gif"></div>'),window.showLoadIcon=function(){$("#loadicon").css({display:"block"})}),showLoadIcon(),tu=TUWidget.init($(".tui-image-editor-canvas-container").eq(0)),tu.done((function(file){if(file.tuInfo&&file.tuInfo.cdnUrl){var newURL=file.tuInfo.cdnUrl,img=document.getElementById(imgid);if(null!=img&&(img.src=newURL),"function"==typeof editcalback)editcalback(imgid,file.tuInfo);else{var $box=$("#"+imgid).closest(".js-image-box");if($box.length>0){$box.find(".js-img-cdnurl").val(newURL),$box.find(".js-img-uuid").val(""),$box.find(".js-img-name").val(""),$box.find(".js-img-size").val(""),$box.find(".js-img-width").val(""),$box.find(".js-img-height").val("");var title=newURL.substring(newURL.length-30);$box.find(".js-img-title").attr("href",newURL).html("..."+title),file.tuInfo.width>0&&$box.find("js-img-width").val(file.tuInfo.width)}else console.log(newURL)}"function"==typeof window.tuiEditor.destroy&&window.tuiEditor.destroy(),$("#tuiEditorTildaWidget").remove(),window.tuiEditor=!1,"function"!=typeof hideLoadIcon&&(window.hideLoadIcon=function(){$("#loadicon").css({display:"none"})}),hideLoadIcon()}})),tu.uploadFileFromURL(dataURL)},window.tuiEditor&&(document.querySelector(".tui__editor-container").style.display="block"),tui_onReady(imageSrc)}function tui_initImageEditor(imageSrc){if(imageSrc.indexOf("ucarecdn")>0||imageSrc.indexOf("tildacdn.info")>0){var pos=imageSrc.lastIndexOf("/");pos!=imageSrc.length-1&&(imageSrc=imageSrc.substring(0,pos+1))}else"/"==imageSrc.substring(0,1)&&(imageSrc="https://tilda.cc"+imageSrc);var options={includeUI:{menu:["newSize","crop","flip","rotate","text","draw","filter"],loadImage:{path:imageSrc,name:"SampleImage"},theme:{"common.bi.image":"","common.bisize.width":"251px","common.bisize.height":"21px","common.backgroundImage":"none","common.backgroundColor":"#1e1e1e","common.border":"0px","header.backgroundImage":"none","header.backgroundColor":"transparent","header.border":"0px","downloadButton.backgroundColor":"#ff855d","downloadButton.border":"1px solid #ff855d","downloadButton.color":"#fff","downloadButton.fontFamily":"tfutura","downloadButton.fontSize":"14px","menu.normalIcon.path":"/tpl/tuieditor/dist/svg/icon-d.svg","menu.normalIcon.name":"icon-d","menu.activeIcon.path":"/tpl/tuieditor/dist/svg/icon-b.svg","menu.activeIcon.name":"icon-b","menu.disabledIcon.path":"/tpl/tuieditor/dist/svg/icon-a.svg","menu.disabledIcon.name":"icon-a","menu.hoverIcon.path":"/tpl/tuieditor/dist/svg/icon-c.svg","menu.hoverIcon.name":"icon-c","menu.iconSize.width":"24px","menu.iconSize.height":"24px","submenu.backgroundColor":"#1e1e1e","submenu.partition.color":"#3c3c3c","submenu.normalIcon.path":"/tpl/tuieditor/dist/svg/icon-d.svg","submenu.normalIcon.name":"icon-d","submenu.activeIcon.path":"/tpl/tuieditor/dist/svg/icon-c.svg","submenu.activeIcon.name":"icon-c","submenu.iconSize.width":"32px","submenu.iconSize.height":"32px","submenu.normalLabel.color":"#8a8a8a","submenu.normalLabel.fontWeight":"400","submenu.activeLabel.color":"#fff","submenu.activeLabel.fontWeight":"400","checkbox.border":"0px","checkbox.backgroundColor":"#fff","range.pointer.color":"#fff","range.bar.color":"#666","range.subbar.color":"#d1d1d1","range.disabledPointer.color":"#414141","range.disabledBar.color":"#282828","range.disabledSubbar.color":"#414141","range.value.color":"#fff","range.value.fontWeight":"lighter","range.value.fontSize":"11px","range.value.border":"1px solid #353535","range.value.backgroundColor":"#151515","range.title.color":"#fff","range.title.fontWeight":"lighter","colorpicker.button.border":"1px solid #1e1e1e","colorpicker.title.color":"#fff"},menuBarPosition:"top",usageStatistics:!1},cssMaxWidth:800,cssMaxHeight:600,usageStatistics:!1};"RU"===window.lang&&(options.includeUI.locale={Undo:"Назад",Redo:"Вперёд",Reset:"Сбросить",Delete:"Удалить","Delete-all":"Удалить всё",Rotate:"Повернуть",Save:"Сохранить",Width:"Ширина",Height:"Высота","Lock proportion":"Сохранить пропорции",Custom:"Произвольный",Crop:"Обрезать",Apply:"Применить",Cancel:"Отменить",Flip:"Развернуть","Flip X":"По горизонтали","Flip Y":"По вертикали",Angle:"Угол",Text:"Добавить текст",Bold:"Жирный",Italic:"Курсив",Underline:"Подчеркнуть",Left:"Влево",Center:"По центру",Right:"Вправо",Color:"Цвет","Text size":"Размер",Draw:"Нарисовать линию",Free:"Свободная",Straight:"Прямая",Size:"Размер",Filter:"Добавить фильтр",Grayscale:"Градации серого",Sepia:"Сепия",Blur:"Размытие",Emboss:"Тиснение",Invert:"Инверсия",Sepia2:"Сепия 2",Sharpen:"Резкость","Remove White":"Удалить белый цвет",Distance:"Расстояние",Value:"Значение",Brightness:"Яркость",Noise:"Шум",Pixelate:"Пикселизация","Color Filter":"Фильтр цвета",Threshold:"Порог"}),window.tuiEditor=new tui.ImageEditor("#tui-image-editor-container",options),window.onresize=function(){window.tuiEditor?window.tuiEditor.ui.resizeEditor():setTimeout((function(){window.onresize()}),300)}}function tui_onReady(imageSrc){if(window.tuiEditor){var tmp=imageSrc.split("/");window.tuiEditor.loadImageFromURL(imageSrc,tmp?tmp[tmp.length-1]:"photo")}else if(window.tuiEditorLoad)tui_addTuiContainer(),tui_initImageEditor(imageSrc);else if(0==$("#tuiEditorTildaScriptVersion").length){var styleTui=document.createElement("link");if(styleTui.rel="stylesheet",styleTui.id="tuiEditorStyle",styleTui.href="/tpl/css/tui.min.css",document.documentElement.appendChild(styleTui),"RU"===window.lang){var styleTuiRussian=document.createElement("style");styleTuiRussian.id="tuiEditorStyleRussian",styleTuiRussian.textContent=".tui-image-editor-container .color-picker-control .tui-image-editor-range {width: 75px;}.tui-image-editor-container .tui-image-editor-submenu-align:first-child label {width: 95px;}.tui-image-editor-container .tui-image-editor-submenu-align label {width: 75px;}.tui-image-editor-container .tui-image-editor-checkbox-wrap.fixed-width {width: 230px;}",document.documentElement.appendChild(styleTuiRussian)}var scriptTui=document.createElement("script");scriptTui.src="/tpl/js/tui-im-edit.min.js",scriptTui.id="tuiEditorTildaScriptVersion",document.documentElement.appendChild(scriptTui),scriptTui.onload=scriptTui.onerror=function(){window.tuiEditorLoad=!0,this.executed||(this.executed=!0,tui_onReady(imageSrc))},scriptTui.onreadystatechange=function(){var self=this;"complete"!=this.readyState&&"loaded"!=this.readyState||setTimeout((function(){self.onload()}),0)}}}function tui_addTuiContainer(){$("#tuiEditorTildaWidget").length>0&&($("#tuiEditorTildaWidget").remove(),window.tuiEditor=!1);var editorContainer=document.createElement("div"),buttonClose;editorContainer.id="tuiEditorTildaWidget",editorContainer.className="tui__editor-container",editorContainer.innerHTML='<div class="tui__editor-fullscreen_bg"></div><div class="tui__editor-wrap"><div class="tui__editor-header"><span>Photo Editor</span><span class="tui__editor-header-close"></span></div><div id="tui-image-editor-container"></div></div>',document.documentElement.appendChild(editorContainer),document.querySelector(".tui__editor-header-close").onclick=function(){editorContainer.style.display="none",window.tuiEditor=!1,$("#tuiEditorTildaWidget").remove()}}function openImageSearchPopup(tildaupload,imgid,recid){recid||(recid=""),showLoadIcon(),$.cachedScript("https://front.tildacdn.com/ccimagesearch/js/t__imagesearch.min.js").done((function(){0==$("#css-tis-imagesearch").length&&$("body").append('<link id="css-tis-imagesearch" rel="stylesheet" href="https://front.tildacdn.com/ccimagesearch/css/t_imagesearch.min.css">'),window.tis__imgid&&window.tis__userid&&window.tis__userhash?(hideLoadIcon(),tis__showImageSearch(tildaupload,window.tis__imgid,window.tis__userid,window.tis__userhash)):$.ajax({type:"POST",url:"/projects/get/getimagesearch/",data:{imgid:imgid,recid:recid,v:2},dataType:"text",success:function(data){check_logout(data),(data=$.parseJSON(data)).userid?(hideLoadIcon(),window.tis__userid=data.userid,window.tis__userhash=data.userhash,tis__showImageSearch(tildaupload,imgid,data.userid,data.userhash)):alert("Not found user")},error:function(){alert("Request Timeout"),location.reload()},timeout:3e4})}))}
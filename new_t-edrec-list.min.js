function edli__init(){var wrapper=$(".editlist__wrapper");if("undefined"==wrapper.attr("data-init-status")||"inited"!=wrapper.attr("data-init-status")&&"begin"!=wrapper.attr("data-init-status")){wrapper.attr("data-init-status","begin");var datastr=$(".editlist__data").html();void 0!==datastr&&""!=datastr||(datastr="{}");var data=JSON.parse(datastr);for(var key in data=edli__dublCheck_Ids(data))edli__drawItem(data[key]);wrapper.attr("data-init-status","inited")}else console.log("error: editlist already inited")}function edli__dublCheck_Ids(data){var ids=[],item,lid,i=0;for(var key in data)if(null!=(item=data[key])&&"object"==typeof item)if(i++,data[key].i=i,(lid=item.lid)in ids){var rnd=Math.floor(1e3*Math.random())+10,newlid=Date.now()-rnd;console.log("new lid: "+newlid),data[key].lid=newlid}else ids[lid]="y";else delete data[key];return data}function edli__drawItem(item,afterlid){var wrapper=$(".editlist__wrapper"),lid=item.lid,ls=item.ls,loff=item.loff,fields=wrapper.attr("data-lfields").split(","),str="",afteritemwrapper;(str+='<div class="pe-list-item" data-listitem-id="'+lid+'" data-listitem-sort="'+ls+'" data-listitem-off="'+loff+'" style="background-color:#efefef; padding:40px; margin:10px 0px; '+("y"==loff?"opacity:0.5;":"")+'">',str+='<div class="pe-list-item-title" style="padding:0px 0px 35px 0px;">',str+='<table style="width:100%; font-size:12px;">',str+="<tr>",str+='<td style="width:100%;letter-spacing:1px;white-space:nowrap;"><b>'+("RU"==lang?"КАРТОЧКА":"ITEM")+' <span class="pe-list-item-i">'+item.i+"</span></b></td>",str+='<td class="pe-list-item-btn-dubl" style="padding:0 10px;"><a href="javascript:edli__dupl('+lid+')">'+("RU"==lang?"Дублировать":"Duplicate")+"</a></td>",str+='<td class="pe-list-item-btn-offon" style="padding:0 10px;"><a href="javascript:edli__off('+lid+')">',"y"==item.loff?str+="RU"==lang?"Включить":"On":str+="RU"==lang?"Выключить":"Off",str+="</a></td>",str+='<td class="pe-list-item-btn-del" style="padding:0 10px;"><a href="javascript:edli__del('+lid+')">'+("RU"==lang?"Удалить":"Delete")+"</a></td>",str+='<td class="pe-list-item-btn-up" style="padding:0 10px;"><a href="javascript:edli__up('+lid+')">'+("RU"==lang?"Вверх":"Up")+"</a></td>",str+='<td class="pe-list-item-btn-down" style="padding:0 0 0 10px;"><a href="javascript:edli__down('+lid+')">'+("RU"==lang?"Вниз":"Down")+"</a></td>",str+="</div>",str+="</div>",afterlid>0)?wrapper.find("[data-listitem-id="+afterlid+"]").after(str):wrapper.append(str);var flag_hascut="";fields.forEach((function(field,i,arr){var value=item[field];"li_img"==field||"li_img2"==field?edli__drawUI__upload(value,field,lid):"li_gallery"==field?edli__drawUI__gallery(value,field,lid):"li_imgalt"==field||"li_img2alt"==field?edli__drawUI__imgalt(value,field,lid):"li_select"==field||"li_select2"==field?edli__drawUI__select(value,field,lid):"li_link"==field||"li_buttonlink"==field||"li_buttonlink2"==field?edli__drawUI__link(value,field,lid):"li_linkprod"==field||"li_buttonlinkprod"==field||"li_buttonlinkprod2"==field?edli__drawUI__linkprod(value,field,lid):"li_linktarget"==field||"li_buttonlinktarget"==field||"li_buttonlinktarget2"==field?edli__drawUI__linktarget(value,field,lid):"li_string"==field||"li_string2"==field||"li_buttontitle"==field||"li_buttontitle2"==field||"li_price"==field||"li_price_old"==field||"li_mark"==field||"li_prod_option"==field||"li_prod_option2"==field||"li_prod_option3"==field||"li_geokeys"==field||"li_source"==field||"li_blocks"==field||"li_blocks2"==field||"li_soclinks"==field?edli__drawUI__input(value,field,lid):"li_prod_variants"==field||"li_prod_variants2"==field||"li_prod_variants3"==field?edli__drawUI__textarea(value,field,lid):"li_cb"==field||"li_cb2"==field?edli__drawUI__checkbox(value,field,lid):"li_cut"==field?(flag_hascut="yes",edli__drawUI__cut(value,field,lid)):edli__drawUI__text(value,field,lid)})),"yes"==flag_hascut&&edli__cutonoff(lid)}function edli__drawUI__input(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;"li_buttontitle"==label&&(label="RU"==lang?"Название кнопки":"Button title"),"li_buttontitle2"==label&&(label="RU"==lang?"Название второй кнопки":"Second button title"),"li_price"==label&&(label="RU"==lang?"Стоимость услуги/товара":"Price of product or service"),"li_price_old"==label&&(label="RU"==lang?"Старая цена":"Old price"),"li_mark"==label&&(label="RU"==lang?"Отметка на карточке (например: sale, new, -30%)":"Card mark (for example, sale, new, -50%)"),"li_prod_option"==label&&(label="RU"==lang?"Название параметра":"Option name"),"li_prod_option2"==label&&(label="RU"==lang?"Название второго параметра":"Option second name"),"li_prod_option3"==label&&(label="RU"==lang?"Название третьего параметра":"Option third name"),"li_soclinks"==label&&(label="RU"==lang?"Ссылки на профили в соц.сетях":"Links on social networks profile");var hint="";if("li_price"==field&&(hint="RU"==lang?"Знак валюты добавляется автоматически. Изменить валюту можно в Настройках сайта.":"The currency sign is added automatically. You can change the currency in the Site Settings."),"li_geokeys"==field&&(hint="<a href=\"javascript:edli_geokeys_open('"+field+"','"+lid+"')\">"+("RU"==lang?"Выбрать гео регион":"Select geo area</a>")),"li_soclinks"==field&&(hint="RU"==lang?"Добавьте ссылки на соцсети через запятую.":"Add a comma-separated list of social networks links."),"object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==lang?rep.label[0]:rep.label[1]),"object"==typeof rep.hint&&(hint="RU"==lang?rep.hint[0]:rep.hint[1])}var str="";str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',str+='    <label class="pe-label">'+label+"</label>",str+='    <input type="text" name="'+field+'" class="pe-input" value="'+value+'" />',"li_blocks"!=field&&"li_blocks2"!=field||(str+='\t<div class="pe-field-link-more" style="margin-top:5px;">',str+='\t<span class="pe-field-link-link-an" style="padding-right:15px; font-size:12px; cursor:context-menu;">'+("RU"==lang?"Выбрать блоки":"Choose blocks")+"</span>",str+="\t</div>"),""!=hint&&(str+='    <div class="pe-hint">'+hint+"</div>"),str+="</div>",itemwrapper.append(str);var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v=inp.val();if(("li_blocks"==field||"li_blocks2"==field)&&""!=v){var foo=v.replace(/[^0-9,]*/g,"");v!=foo&&($(this).val(foo),v=foo)}edli__setFieldValue(v,field,lid)})),"li_blocks"!=field&&"li_blocks2"!=field||inp.parent().find(".pe-field-link-link-an").click((function(){var el_input=$(this).parent().parent().find(".pe-input");edlink__RecordsidsPiker__show(el_input)}))}function edli__drawUI__text(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;if("li_title"==label&&(label="RU"==lang?"Заголовок":"Title"),"li_descr"==label&&(label="RU"==lang?"Описание":"Description"),"li_subtitle"==label&&(label="RU"==lang?"Подзаголовок":"Subtitle"),"li_text"==label&&(label="RU"==lang?"Текст":"Text"),"li_date"==label&&(label="RU"==lang?"Дата":"Date"),"li_time"==label&&(label="RU"==lang?"Время":"Time"),"li_persname"==label&&(label="RU"==lang?"Имя персоны":"Person name"),"li_persdescr"==label&&(label="RU"==lang?"Информ. о персоне":"Person description"),"object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==lang?rep.label[0]:rep.label[1]),"string"==typeof rep.redactor_nohref&&"yes"==rep.redactor_nohref&&setTimeout((function(){$(".pe-form-group[data-lid="+lid+"][data-lfield="+field+"]").find(".re-link").css("display","none")}),1500),"string"==typeof rep.redactor_notoolbar&&"yes"==rep.redactor_notoolbar&&setTimeout((function(){$(".pe-form-group[data-lid="+lid+"][data-lfield="+field+"]").find(".ql-toolbar").remove()}),1500)}var str="";str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',str+='    <label class="pe-label">'+label+"</label>",str+='    <div class="pe-redactor">',str+='    \t<textarea name="'+field+'" class="pe-textarea" rows="2">'+value+"</textarea>",str+="    </div>",str+="</div>",itemwrapper.append(str);var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v;edli__setFieldValue(inp.val(),field,lid)})),addRedactor_to_textarea(inp)}function edli__drawUI__textarea(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;"li_prod_variants"==label&&(label="RU"==lang?"Значения параметра":"Option values"),"li_prod_variants2"==label&&(label="RU"==lang?"Значения второго параметра":"Second option values"),"li_prod_variants3"==label&&(label="RU"==lang?"Значения третьего параметра":"Third option values");var ph="";"li_prod_variants"!=field&&"li_prod_variants2"!=field&&"li_prod_variants3"!=field||(ph="RU"==lang?"Перечислите варианты, отделяя их переносом строки":"Set variants by dividing them with a new line");var hint="";if("li_prod_variants"==field&&(hint="RU"==lang?"Перечислите варианты товара, отделяя их переносом строки. Если вариант имеет свою цену, поставьте знак = и укажите цену (только цифры, без знака валюты). Например: Большой размер 1000 руб. = 1000":"Put product options by dividing them with a new line. If variant has own price, add the sign = and write a price (only numbers, without currency). For example: Large size $10 = 10"),"object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==lang?rep.label[0]:rep.label[1])}var str="";str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',str+='    <label class="pe-label">'+label+"</label>",str+='    <div class="">',str+='    \t<textarea name="'+field+'" style="height:100px; box-sizing: border-box; margin-top:10px;" class="pe-textarea" rows="2" placeholder="'+ph+'">'+value+"</textarea>",str+="    </div>",""!=hint&&(str+='    <div class="pe-hint">'+hint+"</div>"),str+="</div>",itemwrapper.append(str);var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v;edli__setFieldValue(inp.val(),field,lid)}))}function edli__drawUI__select(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;"li_select"==label&&(label="RU"==lang?"Опции":"Options"),"li_select2"==label&&(label="RU"==lang?"Опции 2":"Options 2");var options=[["","По умолчанию","by Default"],["v2","Вариант 2","Option 2"],["v3","Вариант 3","Option 3"]];if("object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==lang?rep.label[0]:rep.label[1]),"object"==typeof rep.options&&(options=rep.options)}var str="";str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',str+='    <label class="pe-label">'+label+"</label>",str+='    <div class="pe-select">',str+='\t\t<select class="pe-input pe-select" name="'+field+'">';for(var i=0;i<options.length;i++)str+='\t\t\t<option value="'+options[i][0]+'" '+(value==options[i][0]?"selected":"")+">"+("RU"==lang?options[i][1]:options[i][2])+"</option>";str+="\t\t</select>",str+="    </div>",str+="</div>",itemwrapper.append(str);var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v;edli__setFieldValue(inp.val(),field,lid)}))}function edli__drawUI__link(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;if("li_link"==label&&(label="RU"==lang?"Ссылка":"Link"),"li_buttonlink"==label&&(label="RU"==lang?"Ссылка для кнопки":"Button link"),"li_buttonlink2"==label&&(label="RU"==lang?"Ссылка для второй кнопки":"Second button link"),"object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==lang?rep.label[0]:rep.label[1])}var str="";str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',str+='  \t<label class="pe-label">'+label+"</label>",str+='\t<div class="form-url-group">',str+='    \t<input type="text" name="'+field+'" class="pe-input" value="'+value+'" style="width:100%;"/>',str+='\t\t<div class="pe-field-link-more" style="margin-top:-2px;">',str+='\t\t<span class="pe-field-link-link-pg" style="padding-right:15px; font-size:11px; cursor:context-menu;">'+("RU"==lang?"Выбрать страницу":"Link to Page")+"</span>",str+='\t\t<span class="pe-field-link-link-an" style="padding-right:15px; font-size:11px; cursor:context-menu;">'+("RU"==lang?"Выбрать блок":"Link to Block")+"</span>",str+="\t\t</div>",str+="\t</div>",str+="</div>",itemwrapper.append(str);var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v=inp.val();if(""!=v){var foo=v.trim();v!=foo&&$(this).val(foo)}checkLinkCCtoWS(v),edli__setFieldValue(v,field,lid)}));var inpwrapper=inp.closest(".form-url-group");inpwrapper.find(".pe-field-link-link-pg").click((function(){var el_input=$(this).parent().parent().find(".pe-input");edlink__showPopUp__pageslist(el_input)})),inpwrapper.find(".pe-field-link-link-an").click((function(){var el_input=$(this).parent().parent().find(".pe-input");edlink__RecordPiker__show(el_input)})),inpwrapper.find(".pe-field-link-cb-target").change((function(){}))}function edli__drawUI__linkprod(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;if("li_linkprod"==label&&(label="RU"==lang?"Ссылка c карточки товара":"Product Link"),"li_buttonlinkprod"==label&&(label="RU"==lang?"Ссылка для кнопки":"Button Link"),"li_buttonlinkprod2"==label&&(label="RU"==lang?"Ссылка для второй кнопки":"Second Button Link"),"object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==lang?rep.label[0]:rep.label[1])}var str="";str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',str+='  \t<label class="pe-label">'+label+"</label>",str+='    <div class="pe-select">',str+='\t\t<select class="pe-input pe-select" name="'+field+'">',str+='\t\t\t<option value="" '+(""==value?"selected":"")+">"+("RU"==lang?"Ссылка на страницу":"Link on page")+"</option>",str+='\t\t\t<option value="popup" '+("popup"==value?"selected":"")+">"+("RU"==lang?"Подробнее о товаре":"View full product info")+"</option>",str+='\t\t\t<option value="order" '+("order"==value?"selected":"")+">"+("RU"==lang?"Добавить в корзину":"Add to Cart")+"</option>",str+="\t\t</select>",str+="    </div>",str+="</div>";var linkfield=field.replace("prod",""),linkwrapper=itemwrapper.find("[data-lfield="+linkfield+"]");linkwrapper.before(str),linkwrapper.find(".pe-label").remove();var linkinp=itemwrapper.find("[name="+linkfield+"]"),linkuiwrapper=linkwrapper.find(".form-url-group");linkuiwrapper.css("margin-top","-20px"),"popup"!=value&&"order"!=value||linkuiwrapper.css("display","none");var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v=inp.val();edli__setFieldValue(v,field,lid),"popup"==v||"order"==v?linkuiwrapper.css("display","none"):linkuiwrapper.css("display","block"),""==v&&(linkinp.val(""),edli__setFieldValue("",linkfield,lid)),"popup"==v&&(linkinp.val("#prodpopup"),edli__setFieldValue("#prodpopup",linkfield,lid)),"order"==v&&(linkinp.val("#order"),edli__setFieldValue("#order",linkfield,lid))}))}function edli__drawUI__linktarget(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var str="";str+='<div class="pe-target-div" data-lid="'+lid+'" data-lfield="'+field+'" style="display:inline-block;">',str+='\t<label class="pe-label-checkbox pe-label-target" style="padding-right:15px; font-size:11px;">',str+='\t  \t<input type="hidden" name="'+field+'" value="'+value+'" class="pe-input-target pe-cb-target-'+field+'"/>',str+='      \t<input type="checkbox" style="width:auto;" class="pe-cb-target pe-cb-target-'+field+'" '+("_blank"==value?'checked="checked"':"")+'> <span class="pe-checkbox-title">'+("RU"==lang?"В новом окне":"New window")+"</span>",str+="\t</label>",str+="</div>";var linkfield=field.replace("target",""),linkwrapper=itemwrapper.find("[data-lfield="+linkfield+"]").find(".form-url-group");linkwrapper.find(".pe-field-link-more").prepend(str);var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v;edli__setFieldValue(inp.val(),field,lid)})),linkwrapper.find(".pe-cb-target-"+field).change((function(){var tempv=$(this).is(":checked");tempv=tempv?"_blank":"",linkwrapper.find(".pe-cb-target-"+field).val(tempv)}))}function edli__drawUI__linktarget_old(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var str="";str+='<div class="pe-select-div" data-lid="'+lid+'" data-lfield="'+field+'">',str+='    <div class="pe-select">',str+='\t\t<select class="pe-input pe-select" name="'+field+'">',str+='\t\t\t<option value="" '+(""==value?"selected":"")+">"+("RU"==window.lang?"В этом же окне":"Same window")+"</option>",str+='\t\t\t<option value="_blank" '+("_blank"==value?"selected":"")+">"+("RU"==window.lang?"В новом окне":"New window")+"</option>",str+="\t\t</select>",str+="    </div>",str+="</div>";var linkfield=field.replace("target",""),linkwrapper;itemwrapper.find("[data-lfield="+linkfield+"]").find(".form-url-group").append(str);var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v;edli__setFieldValue(inp.val(),field,lid)}))}function edli__drawUI__upload(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]"),form=itemwrapper.closest("form"),recid=form.length>0?form.data("rec-id"):"";void 0===value&&(value="");var label=field;"li_img"==label&&(label="RU"==window.lang?"Изображение":"Image"),"li_img2"==label&&(label="RU"==window.lang?"Изображение 2":"Image 2");var tumaxwidth="",tumaxheight="";if("object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==window.lang?rep.label[0]:rep.label[1]),"string"==typeof rep["tu-max-width"]&&(tumaxwidth='data-tu-max-width="'+rep["tu-max-width"]+'"'),"string"==typeof rep["tu-max-height"]&&(tumaxheight='data-tu-max-height="'+rep["tu-max-height"]+'"')}var str="";str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',str+='    <label class="pe-label">'+label+"</label>",str+="\t<br>",str+='    <div class="js-image-box">',str+='    \t<input name="'+field+'" value="'+value+'" style="display:none;" class="js-img-cdnurl"/>',str+='\t    <table style="width:100%;">',str+="\t\t<tr>",str+='\t\t\t<td style="width:240px; vertical-align:top;">',str+='\t\t\t<div style="width:100%;">',str+='\t\t\t<input type="text" name="li-tubutton" class="js-img-button" value="" data-tu-is-image="yes" '+tumaxwidth+" "+tumaxheight+' id="tuwidget'+lid+"_"+field+'" /><br>',str+="\t\t\t</div>",str+="\t\t\t</td>",str+='\t\t\t<td class="pe-imagesearch-td-wrapper">',str+='\t\t\t\t<div class="pe-imagesearch-btn">',str+='\t\t\t\t\t<img src="https://tilda.ws/img/linea/basic_magnifier.svg" style="padding:10px" width="20px">',str+='\t\t\t\t\t<span style="vertical-align: middle">'+("RU"==window.lang?"Искать в библиотеке":"Search photos")+"</span>",str+="\t\t\t\t</div>",str+="\t\t\t</td>",str+="\t\t</tr>",str+="\t    </table>",str+='\t\t<div class="js-img-div"></div>',str+="\t</div>",str+="</div>",itemwrapper.append(str),""!=value&&edli__drawUI__upload__imgdiv(value,field,lid);var fieldwrapper=itemwrapper.find("[data-lfield="+field+"]"),inp=fieldwrapper.find("[name="+field+"]");inp.change((function(){var v;edli__setFieldValue(inp.val(),field,lid)})),itemwrapper.find(".pe-imagesearch-btn").click((function(){var tu=$("#tuwidget"+lid+"_"+field).data("tildaupload");openImageSearchPopup(tu,"lst"+lid+"_"+field+"id",recid)})),fieldwrapper.find(".js-img-button").each((function(){var $this=$(this),elementid=$this.attr("id");elementid||(elementid="tuwidget"+parseInt(Math.floor(Math.random()*(9e5+1))+99999),$this.attr("id",elementid)),TUWidget.init($this).done((function(file){void 0!==file.tuInfo.cdnUrl&&""!=file.tuInfo.cdnUrl&&(inp.val(file.tuInfo.cdnUrl),inp.trigger("change"),edli__drawUI__upload__imgdiv(file.tuInfo.cdnUrl,field,lid)),setTimeout((function(){$("#"+elementid+"-previews").removeClass("tu-popup-progressbar-completed").removeClass("tu-processing").removeClass("tu-image-preview").removeClass("tu-success").removeClass("tu-complete").addClass("tu-popup-progressbar-start")}),3e3)})).fail((function(file,message){}))}))}function edli__drawUI__upload__imgdiv(src,field,lid){var wrapper=$(".editlist__wrapper"),itemwrapper,fieldwrapper,div=wrapper.find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find(".js-img-div"),name=src;name=name.substr(name.length-30);var fields=wrapper.attr("data-lfields");void 0===fields&&(fields="");var needalt,str="";str+="<br>",str+='<table class="pe-imagebox__table">',str+='\t<tr class="pe-imagebox__tr">',str+='\t\t<td class="pe-imagebox__td pe-imagebox__td-thumb">',str+='\t\t\t<img src="'+src+'" width="135" class="pe-imagebox__img js-img-thumb" id="lst'+lid+"_"+field+'id" />',str+="\t\t</td>",str+='\t\t<td class="pe-imagebox__td pe-imagebox__td-name" style="padding-left:20px; padding-right:20px; width:500px; font-size:12px; color:#333;"><a href="'+src+'" target="_blank" class="js-img-title" data-li-img-href="">... '+name+"</a></td>",fields.indexOf(field+"alt")>0&&(str+='\t<td class="pe-imagebox__td" style="white-space: nowrap;"><a href="javascript:edli__drawUI__upload__showmore(\''+field+"','"+lid+"');\">...</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>"),""!=name&&-1===name.indexOf(".svg")&&(str+='\t<td class="pe-imagebox__td" style="white-space: nowrap; padding-right: 10px;"><a href="javascript:tui_editimage(\''+lid+"','lst"+lid+"_"+field+'id\');" class="js-edit-img"><span class="glyphicon glyphicon-pencil"></span></a></td>'),str+='\t\t<td class="pe-imagebox__td"><a href="javascript:edli__drawUI__upload__del(\''+field+"','"+lid+'\');"><span class="glyphicon glyphicon-trash"></span></a></td>',str+="\t</tr>",str+="</table>",div.html(str)}function edli__drawUI__upload__showmore(field,lid){var wrapper,itemwrapper,div=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find(".pe-form-group__"+field+"alt");"none"==div.css("display")?div.css("display","block"):div.css("display","none")}function edli__drawUI__imgalt(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;"li_imgalt"!=label&&"li_img2alt"!=label||(label="RU"==lang?"SEO: Альт-текст для изображения":"SEO: Image alt text");var str="";str+='<div class="pe-form-group pe-form-group__'+field+'" data-lid="'+lid+'" data-lfield="'+field+'" style="display:none;">',str+='    <label class="pe-label">'+label+"</label>",str+='    <input type="text" name="'+field+'" class="pe-input" value="'+value+'" />',str+="</div>",itemwrapper.append(str);var inp=itemwrapper.find("[name="+field+"]");inp.change((function(){var v;edli__setFieldValue(inp.val(),field,lid)}))}function edli__drawUI__upload__del(field,lid){var wrapper,itemwrapper,fieldwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]"),div=fieldwrapper.find(".js-img-div"),inp=fieldwrapper.find("[name="+field+"]");div.html(""),inp.val(""),inp.trigger("change")}function edli__drawUI__upload__tui_editimg(field,lid){$(document).ready((function(){var wrapper,itemwrapper,fieldwrapper,src=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find(".js-img-thumb").attr("src"),imageitemid;tui_editimage(lid,"lst"+lid+"_"+field+"id",(function(imgid,tuInfo){if(tuInfo){var newURL=tuInfo.cdnUrl,$box=$("#"+imgid).closest(".js-image-box");if($box.length>0){$box.find(".js-img-cdnurl").val(newURL),$box.find(".js-img-uuid").val(""),$box.find(".js-img-name").val(""),$box.find(".js-img-size").val(""),$box.find(".js-img-width").val(""),$box.find(".js-img-height").val("");var title=newURL.substring(newURL.length-30);$box.find(".js-img-title").attr("href",newURL).html("..."+title),tuInfo.width>0&&$box.find("js-img-width").val(tuInfo.width)}}}))}))}function edli__drawUI__upload__aviary_editimg(field,lid){$(document).ready((function(){aviaryOnReady((function(){var wrapper,itemwrapper,fieldwrapper,src=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find(".js-img-thumb").attr("src"),imageitemid="lst"+lid+"_"+field+"id";window.featherEditor.launch({image:imageitemid,url:src,onLoad:function(){alert("loadd")},onSave:function(imageID,newURL){var img;document.getElementById(imageID).src=newURL;var $box=$("#"+imageitemid).closest(".js-image-box");$box.find(".js-img-cdnurl").val(newURL),$box.find(".js-img-uuid").val(""),$box.find(".js-img-name").val(""),$box.find(".js-img-size").val(""),$box.find(".js-img-width").val(""),$box.find(".js-img-height").val("");var title=newURL.substring(newURL.length-30);$box.find(".js-img-title").attr("href",newURL).html("..."+title);var size=window.featherEditor.getImageDimensions();return size&&size.width&&$box.find("js-img-width").val(size.width),window.featherEditor.close()}})}))}))}function edli__drawUI__checkbox(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label="",labelcb="";"li_cb"==field&&(lang,labelcb="Checkbox"),"li_cb2"==field&&(lang,labelcb="Checkbox 2");var hint="";if("object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==lang?rep.label[0]:rep.label[1]),"object"==typeof rep.labelcb&&(labelcb="RU"==lang?rep.labelcb[0]:rep.labelcb[1]),"object"==typeof rep.hint&&(hint="RU"==lang?rep.hint[0]:rep.hint[1])}var str="";str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',""!=label&&(str+='<label class="pe-label">'+label+"</label>"),str+='<input class="pe-input" type="hidden" name="'+field+'" value="'+value+'" style="display:none;" />',str+='<div class="pe-checkbox-box">',str+='<label class="pe-label-checkbox">',str+='<input type="checkbox" name="'+field+'-cb" '+("on"==value?'checked="checked"':"")+'> <span class="pe-checkbox-title pe-labelcb">'+labelcb+"</span>",str+="</label>",str+="</div>",""!=hint&&(str+='    <div class="pe-hint">'+hint+"</div>"),str+="</div>",itemwrapper.append(str);var inp=itemwrapper.find("[name="+field+"]"),inpcb=itemwrapper.find("[name="+field+"-cb]");inpcb.change((function(){var v="";1==inpcb.prop("checked")&&(v="on"),inp.val(v),edli__setFieldValue(v,field,lid)}))}function edli__drawUI__cut(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;label="RU"==lang?"Еще...":"More...";var str="";if("object"==typeof window.lireplaces[field]){var rep=window.lireplaces[field];"object"==typeof rep.label&&(label="RU"==lang?rep.label[0]:rep.label[1])}str+='<div class="pe-form-group" data-list-cut="yes" data-lid="'+lid+'" data-lfield="'+field+'">',str+='    <span class="editlist__btncut" style="cursor:pointer;color:#ff855D;" data-label="'+label+'">'+label+"</a>",str+="</div>",itemwrapper.append(str);var inp=itemwrapper.find(".editlist__btncut");inp.click((function(){"Свернуть"==inp.html()||"Hide"==inp.html()?inp.html(inp.attr("data-label")):inp.html("RU"==lang?"Свернуть":"Hide"),edli__cutonoff(lid)}))}function edli__cutonoff(lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]"),flag="";itemwrapper.find(".pe-form-group").each((function(){var el=$(this);"y"==flag&&("none"==el.css("display")?el.css("display","block"):el.css("display","none")),"yes"==el.attr("data-list-cut")&&(flag="y")}))}function edli__drawUI__cutclose(value,field,lid){var wrapper,itemwrapper;void 0===value&&(value="");var label=field,str="";str+="</div>",$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").append(str)}function edli__setFieldValue(v,field,lid){var v_len;v.length>3e3?alert("RU"==window.lang?"Предупреждение: в поле слишком много текста. Мы рекомендуем его сократить.":"Note: Too much data in this input field. We strongly recommend reducing the amount of information."):edli__allitems__getData__inJson()}function edli__allitems__getData__inJson(){var wrapper=$(".editlist__wrapper");if("inited"==wrapper.attr("data-init-status")){var fields=wrapper.attr("data-lfields").split(","),data={},i=0;$(".pe-list-item").each((function(){var it=$(this),item={};item.lid=it.attr("data-listitem-id"),item.ls=it.attr("data-listitem-sort"),item.loff=it.attr("data-listitem-off"),"y"==item.loff?item.loff="y":item.loff="";var foo="";fields.forEach((function(field,i,arr){"lid"!=field&&"ls"!=field&&"loff"!=field&&("<br>"==(foo=it.find("[name="+field+"]").val())&&(foo=""),item[field]=foo)})),data[i]=item,i++}));var datastr=JSON.stringify(data),datastr_len;datastr.length>45e3?alert("RU"==window.lang?"Ошибка: в поле слишком много текста. Изменения не будут сохранены. Пожалуйста, удалите часть информации.":"Error: Too much data in this input field. Changes will not be saved. Please delete some of the information."):$(".editlist__data").val(datastr)}else console.log("Error getdatainjson: Initing listeditor not finished")}function edli__add(){var item={},rnd=Math.floor(1e3*Math.random())+10,newlid=Date.now()-rnd;item.lid=newlid;var maxsort=edli__getMaxSort();item.ls=maxsort+10,edli__drawItem(item),edli__allitems__Resort(),edli__allitems__getData__inJson();var wrapper=$(".editlist__wrapper"),listwrapper=$("#editformsxl").find(".pe-form-group[data-tpl-field=list]"),yy=wrapper.find(".pe-list-item[data-listitem-id="+newlid+"]").position().top+listwrapper.position().top;listwrapper.parents(".pe-form-group[data-tpl-group]").length>0&&(yy+=listwrapper.parents(".pe-form-group[data-tpl-group]").position().top),listwrapper.parents(".pe-form-group-wrapper").length>0?$("#editformsxl").animate({scrollTop:$("#editformsxl").position().top+yy},700):$("#editformsxl").animate({scrollTop:$("#editformsxl").scrollTop()+yy-100},700)}function edli__del(lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");itemwrapper.slideUp("fast",(function(){itemwrapper.remove(),edli__allitems__Resort(),edli__allitems__getData__inJson()}))}function edli__off(lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]"),off;"y"==itemwrapper.attr("data-listitem-off")?(itemwrapper.attr("data-listitem-off",""),itemwrapper.css("opacity",""),itemwrapper.find(".pe-list-item-btn-offon").find("a").html("RU"==lang?"Выключить":"Off")):(itemwrapper.attr("data-listitem-off","y"),itemwrapper.css("opacity","0.5"),itemwrapper.find(".pe-list-item-btn-offon").find("a").html("RU"==lang?"Включить":"On")),edli__allitems__getData__inJson()}function edli__down(lid){var wrapper=$(".editlist__wrapper"),itemwrapper=wrapper.find("[data-listitem-id="+lid+"]"),nextitemwrapper=itemwrapper.next(".pe-list-item");if(0!=nextitemwrapper.length){var content=itemwrapper.detach();nextitemwrapper.after(content),edli__allitems__Resort(),edli__allitems__getData__inJson(),setTimeout((function(){var listwrapper=$("#editformsxl").find(".pe-form-group[data-tpl-field=list]"),yy=wrapper.find(".pe-list-item[data-listitem-id="+lid+"]").position().top+listwrapper.position().top;listwrapper.parents(".pe-form-group[data-tpl-group]").length>0&&(yy+=listwrapper.parents(".pe-form-group[data-tpl-group]").position().top),$("#editformsxl").stop(!0),listwrapper.parents(".pe-form-group-wrapper").length>0?$("#editformsxl").animate({scrollTop:$("#editformsxl").position().top+yy},700):$("#editformsxl").animate({scrollTop:$("#editformsxl").scrollTop()+yy-100},700)}),100)}}function edli__up(lid){var wrapper=$(".editlist__wrapper"),itemwrapper=wrapper.find("[data-listitem-id="+lid+"]"),previtemwrapper=itemwrapper.prev(".pe-list-item");if(0!=previtemwrapper.length){var content=itemwrapper.detach();previtemwrapper.before(content),edli__allitems__Resort(),edli__allitems__getData__inJson(),setTimeout((function(){var listwrapper=$("#editformsxl").find(".pe-form-group[data-tpl-field=list]"),yy=wrapper.find(".pe-list-item[data-listitem-id="+lid+"]").position().top+listwrapper.position().top;listwrapper.parents(".pe-form-group[data-tpl-group]").length>0&&(yy+=listwrapper.parents(".pe-form-group[data-tpl-group]").position().top),$("#editformsxl").stop(!0),listwrapper.parents(".pe-form-group-wrapper").length>0?$("#editformsxl").animate({scrollTop:$("#editformsxl").position().top+yy},700):$("#editformsxl").animate({scrollTop:$("#editformsxl").scrollTop()+yy-100},700)}),100)}}function edli__dupl(lid){var wrapper=$(".editlist__wrapper"),itemwrapper=wrapper.find("[data-listitem-id="+lid+"]"),fields=wrapper.attr("data-lfields").split(","),item={},rnd=Math.floor(1e3*Math.random())+10,newlid=Date.now()-rnd;item.lid=newlid,fields.forEach((function(field,i,arr){var value;"lid"!=field&&"ls"!=field&&("q"===window.ver_redactor?void 0===(value=itemwrapper.find("[name="+field+"] .ql-editor").html())?value=itemwrapper.find("[name="+field+"]").val():"<br />"===(value=(value=value.replace(/<br>/gi,"")).replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br />")).slice(-6)&&"<br /><br />"!==value.slice(-12)&&(value=value.substring(0,value.length-6)):value=itemwrapper.find("[name="+field+"]").val(),item[field]=value)}));var sort=1*parseInt(itemwrapper.attr("data-listitem-sort")),afterlid;item.ls=sort+5,edli__drawItem(item,lid),edli__allitems__Resort(),edli__allitems__getData__inJson(),setTimeout((function(){var listwrapper=$("#editformsxl").find(".pe-form-group[data-tpl-field=list]"),yy=wrapper.find(".pe-list-item[data-listitem-id="+newlid+"]").position().top+listwrapper.position().top;listwrapper.parents(".pe-form-group[data-tpl-group]").length>0&&(yy+=listwrapper.parents(".pe-form-group[data-tpl-group]").position().top),$("#editformsxl").stop(!0),listwrapper.parents(".pe-form-group-wrapper").length>0?$("#editformsxl").animate({scrollTop:$("#editformsxl").position().top+yy},700):$("#editformsxl").animate({scrollTop:$("#editformsxl").scrollTop()+yy-100},700)}),100)}function edli__getMaxSort(){var wrapper=$(".editlist__wrapper"),max=0,isort=0;return wrapper.find(".pe-list-item").each((function(){isort=parseInt($(this).attr("data-listitem-sort")),max<isort&&(max=isort)})),max}function edli__allitems__Resort(){var wrapper=$(".editlist__wrapper"),sort=10,i=0;wrapper.find(".pe-list-item").each((function(){var it=$(this);i++,sort=10*i,it.attr("data-listitem-sort",sort),it.find(".pe-list-item-i").html(i)}))}function edli__drawUI__gallery(value,field,lid){var wrapper,itemwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]");void 0===value&&(value="");var label=field;"li_gallery"==label&&(label="RU"==window.lang?"Список изображений":"Images list");var tumaxwidth="",tumaxheight="",str="",fieldwrapper;if(str+='<div class="pe-form-group" data-lid="'+lid+'" data-lfield="'+field+'">',str+='    <label class="pe-label">'+label+"</label>",str+="\t<br>",str+='    <div class="js-gallery-upload-widget">',str+='    \t<textarea name="'+field+'" class="js-gallery-json" style="display:none;" rows="1">'+value+"</textarea>",str+='\t    <table style="width:100%;">',str+="\t\t<tr>",str+='\t\t<td style="width:240px; vertical-align:top;">',str+='\t\t<div style="width:100%;">',str+='\t\t<input type="text" name="li-tubutton" class="js-imgs-button" value="" data-tu-is-image="yes" data-tu-multiple="yes"   id="tuwidget'+lid+"_"+field+'" /><br>',str+="\t\t</div>",str+="\t\t</td>",str+='\t\t<td style="vertical-align:top; text-align:right;">',str+="\t\t</td>",str+="\t\t</tr>",str+="\t    </table>",str+='\t\t<div class="js-gallery-items"></div>',str+="\t</div>",str+="</div>",itemwrapper.append(str),""!=value)try{var obj=$.parseJSON(value);"object"==typeof obj&&$.each(obj,(function(index,item){void 0!==item.img&&""!=item.img&&edli__drawUI__gallery__drawitem(item.img,item.alt,field,lid)}))}catch(err){}itemwrapper.find("[data-lfield="+field+"]").find(".js-imgs-button").each((function(){var $this=$(this),elementid,elementid;(elementid=$this.attr("id"))||(elementid="tuwidget"+parseInt(Math.floor(Math.random()*(9e5+1))+99999),$this.attr("id",elementid)),TUWidget.init($this).done((function(file){if(this.options.uploadMultiple){for(i in file){var src=file[i].tuInfo.cdnUrl,uuid=file[i].tuInfo.uuid;void 0!==src?edli__drawUI__gallery__drawitem(src,"",field,lid,uuid):console.log("hmm, src is undefined")}edli__drawUI__gallery__updatejsonvalue(field,lid)}else console.log("HMMM..!!");setTimeout((function(){$("#"+elementid+"-previews").removeClass("tu-popup-progressbar-completed").removeClass("tu-processing").removeClass("tu-image-preview").removeClass("tu-success").removeClass("tu-complete").addClass("tu-popup-progressbar-start")}),500)})).fail((function(file,message){}))})),edli__drawUI__gallery__sortable(field,lid)}function edli__drawUI__gallery__drawitem(src,alt,field,lid,uuid,replace_item_el){var wrapper=$(".editlist__wrapper"),itemwrapper,fieldwrapper,div=wrapper.find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find(".js-gallery-items"),name=src;name=name.substr(name.length-30),void 0!==uuid&&""!=uuid||(uuid=Math.floor(1e7*Math.random())+1e3),void 0===alt&&(alt="");var fields,needalt=wrapper.attr("data-lfields").indexOf(field+"alt"),str="";str+='<div class="js-gallery-item" data-uuid="'+uuid+'" data-src="'+src+'" data-alt="'+alt+'" style="margin:10px 0;">',str+='<table class="pe-imagebox__table" style="font-size:12px;">',str+='<tr class="pe-imagebox__tr">',str+='<td class="pe-imagebox__td">',str+='<img src="'+src+'" width="80" class="pe-imagebox__galimg js-img-thumb" id="lst'+lid+"_"+field+"id_uuid"+uuid+'" />',str+="</td>",str+='<td class="pe-imagebox__td-name" style="padding-left:20px; padding-right:20px; width:500px; font-size:12px; color:#333;"><a href="'+src+'" target="_blank" class="js-img-title" data-li-img-href="">... '+name+"</a></td>",str+='<td class="pe-imagebox__td"><div class="js-img-updatebtn"><a href="javascript:edli__drawUI__gallery__update(\''+field+"','"+lid+"','"+uuid+"');\">"+("RU"==lang?"Заменить&nbsp;фото":"Replace&nbsp;image")+"</a></div></td>",str+='<td class="pe-imagebox__td" style="padding-left:20px; white-space: nowrap;"><a href="javascript:edli__drawUI__gallery__showmore(\''+field+"','"+lid+"','"+uuid+"');\">...</a></td>",str+='<td class="pe-imagebox__td" style="padding-left:10px;"><a href="javascript:edli__drawUI__gallery__tui_editimg(\''+field+"','"+lid+"','"+uuid+'\');" class="js-edit-img"><span class="glyphicon glyphicon-pencil"></span></a></td>',str+='<td class="pe-imagebox__td" style="padding-left:10px; width:20px;"><a href="javascript:edli__drawUI__gallery__del(\''+field+"','"+lid+"','"+uuid+'\');"><span class="glyphicon glyphicon-trash"></span></a></td>',str+="</tr>",str+="</table>",str+='<div class="js-gallery-item-showmore-div" style="display:none; margin:30px 0;">',str+='    <label class="pe-label">'+("RU"==lang?"SEO: Альт-текст для изображения":"SEO: Image alt text")+"</label>",str+='    <input type="text" class="pe-input" value="'+alt+'" />',str+="</div>",str+="</div>","object"==typeof replace_item_el?replace_item_el.replaceWith(str):div.append(str);var el=div.find("[data-uuid="+uuid+"]");el.find(".js-img-updatebtn").each((function(){var $this=$(this),elementid,elementid;(elementid=$this.attr("id"))||(elementid="tuwidget"+parseInt(Math.floor(Math.random()*(9e5+1))+99999),$this.attr("id",elementid)),TUWidget.init($this).done((function(file){void 0!==file.tuInfo.cdnUrl?(edli__drawUI__gallery__drawitem(file.tuInfo.cdnUrl,"",field,lid,"",el),edli__drawUI__gallery__updatejsonvalue(field,lid)):console.log("hm, file.tuInfo.cdnUrl is undefined")})).fail((function(file,message){}))}));var inpalt=el.find(".js-gallery-item-showmore-div").find(".pe-input");inpalt.change((function(){var val=inpalt.val();void 0===val&&(val="");var map={"<":"&lt;",">":"&gt;",'"':"&quot;"};val=val.replace(/[<>"]/g,(function(m){return map[m]})),el.attr("data-alt",val),edli__drawUI__gallery__updatejsonvalue(field,lid)}))}function edli__drawUI__gallery__updatejsonvalue(field,lid){var wrapper,itemwrapper,fieldwrapper=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]"),el,src,alt,arr=[],itemObj={};fieldwrapper.find(".js-gallery-items").find(".js-gallery-item").each((function(){el=$(this),src=el.attr("data-src"),alt=el.attr("data-alt"),(itemObj={}).img=src,void 0!==alt&&""!=alt&&(itemObj.alt=alt),arr.push(itemObj)}));var jsonString=JSON.stringify(arr),inp=fieldwrapper.find("[name="+field+"]");inp.val(jsonString),inp.trigger("change")}function edli__drawUI__gallery__del(field,lid,uuid){var wrapper,itemwrapper,fieldwrapper,div;$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find(".js-gallery-items").find("[data-uuid="+uuid+"]").remove(""),edli__drawUI__gallery__updatejsonvalue(field,lid)}function edli__drawUI__gallery__sortable(field,lid){var wrapper,itemwrapper,fieldwrapper;$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find(".js-gallery-items").sortable({helper:"clone",opacity:.8,revert:!0,tolerance:"pointer",axis:"y",update:function(event,ui){edli__drawUI__gallery__updatejsonvalue(field,lid)}})}function edli__drawUI__gallery__tui_editimg(field,lid,uuid){$(document).ready((function(){var wrapper,itemwrapper,fieldwrapper,itemdiv,src=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find('.js-gallery-item[data-uuid="'+uuid+'"]').find(".js-img-thumb").attr("src"),imageitemid="lst"+lid+"_"+field+"id_uuid"+uuid;tui_editimage(lid,imageitemid,(function(imgid,tuInfo){if(tuInfo){var newURL=tuInfo.cdnUrl,$box;if(($box=$("#"+imgid).closest(".js-image-box")).length>0){var $box;($box=$("#"+imageitemid).closest(".js-gallery-item")).attr("data-src",newURL);var title=newURL.substring(newURL.length-30);$box.find(".js-img-title").attr("href",newURL).html("..."+title),$box.find(".js-img-updatebtn").find("a").trigger("click"),setTimeout((function(){$(".tu-popup").css("display","none")}),100),setTimeout((function(){$(".tu-popup").find(".tu-uploadurl-input").val(newURL)}),200),setTimeout((function(){$(".tu-popup").find(".tu-uploadurl-btn").trigger("click")}),500)}else if(($box=$("#"+imgid).closest(".js-gallery-item")).length>0){$box.attr("data-src",newURL);var title=newURL.substring(newURL.length-30),oldurl=$box.find(".js-img-title").attr("href");$box.find(".js-img-title").attr("href",newURL).html("..."+title);var lid=$box.closest(".pe-form-group").data("lid"),field;edli__drawUI__gallery__updatejsonvalue($box.closest(".pe-form-group").data("lfield"),lid)}}}))}))}function edli__drawUI__gallery__aviary_editimg(field,lid,uuid){$(document).ready((function(){aviaryOnReady((function(){var wrapper,itemwrapper,fieldwrapper,itemdiv,src=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find('.js-gallery-item[data-uuid="'+uuid+'"]').find(".js-img-thumb").attr("src"),imageitemid="lst"+lid+"_"+field+"id_uuid"+uuid;window.featherEditor.launch({image:imageitemid,url:src,onLoad:function(){alert("loadd")},onSave:function(imageID,newURL){var img;document.getElementById(imageID).src=newURL;var $box=$("#"+imageitemid).closest(".js-gallery-item");$box.attr("data-src",newURL);var title=newURL.substring(newURL.length-30);return $box.find(".js-img-title").attr("href",newURL).html("..."+title),$box.find(".js-img-updatebtn").find("a").trigger("click"),setTimeout((function(){$(".tu-popup").css("display","none")}),100),setTimeout((function(){$(".tu-popup").find(".tu-uploadurl-input").val(newURL)}),200),setTimeout((function(){$(".tu-popup").find(".tu-uploadurl-btn").trigger("click")}),500),window.featherEditor.close()}})}))}))}function edli__drawUI__gallery__showmore(field,lid,uuid){var wrapper,itemwrapper,fieldwrapper,imgdiv,div=$(".editlist__wrapper").find("[data-listitem-id="+lid+"]").find("[data-lfield="+field+"]").find('.js-gallery-item[data-uuid="'+uuid+'"]').find(".js-gallery-item-showmore-div");"none"==div.css("display")?div.css("display","block"):div.css("display","none")}function edli_geokeys_open(field,lid){var el=$(".pe-form-group[data-lid='"+lid+"']").find("input[name='"+field+"']"),l="EN";"RU"==lang&&(l="RU"),$.getScript("https://geo.tildacdn.com/script.js",(function(){gs__open(el,l)}))}